kubectl label namespace tenant-a tenant=tenant-a
kubectl label namespace tenant-b tenant=tenant-b


Each tenant only controls their own identity, nothing else.

values-tenant-a.yaml
tenant:
  name: tenant-a
  namespace: tenant-a

networkPolicy:
  enabled: true

  allowSameTenant: true

  allowDNS: true

  extraEgress: []
  # Example:
  # - toCIDR: 10.0.0.0/16
  #   ports:
  #     - port: 443

values-tenant-b.yaml
tenant:
  name: tenant-b
  namespace: tenant-b

networkPolicy:
  enabled: true
  allowSameTenant: true
  allowDNS: true

2ï¸âƒ£ Namespace Template (Helm)

This ensures labels are consistent (critical for isolation).

apiVersion: v1
kind: Namespace
metadata:
  name: {{ .Values.tenant.namespace }}
  labels:
    tenant: {{ .Values.tenant.name }}


âœ” No tenant can fake another tenantâ€™s label
âœ” Namespace selector remains trustworthy

3ï¸âƒ£ Default Deny NetworkPolicy (Template)

templates/networkpolicy-default-deny.yaml

{{- if .Values.networkPolicy.enabled }}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-deny
  namespace: {{ .Values.tenant.namespace }}
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
{{- end }}

4ï¸âƒ£ Allow Same-Tenant Traffic Only

templates/networkpolicy-allow-same-tenant.yaml

{{- if and .Values.networkPolicy.enabled .Values.networkPolicy.allowSameTenant }}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-same-tenant
  namespace: {{ .Values.tenant.namespace }}
spec:
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              tenant: {{ .Values.tenant.name }}
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              tenant: {{ .Values.tenant.name }}
{{- end }}


âœ” Prevents cross-tenant access
âœ” Scales to hundreds of tenants

5ï¸âƒ£ DNS Access Policy (Required)

Without this, pods wonâ€™t resolve anything.

templates/networkpolicy-dns.yaml

{{- if and .Values.networkPolicy.enabled .Values.networkPolicy.allowDNS }}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-dns
  namespace: {{ .Values.tenant.namespace }}
spec:
  podSelector: {}
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector:
            matchLabels:
              kubernetes.io/metadata.name: kube-system
          podSelector:
            matchLabels:
              k8s-app: kube-dns
      ports:
        - protocol: UDP
          port: 53
        - protocol: TCP
          port: 53
{{- end }}

6ï¸âƒ£ Optional: Controlled External Egress

Tenants cannot access each other, but may need controlled egress.

values.yaml
networkPolicy:
  extraEgress:
    - toCIDR: 0.0.0.0/0
      ports:
        - port: 443

Template Snippet
{{- range .Values.networkPolicy.extraEgress }}
- to:
    - ipBlock:
        cidr: {{ .toCIDR }}
  ports:
  {{- range .ports }}
    - protocol: TCP
      port: {{ .port }}
  {{- end }}
{{- end }}


âœ” Tenants only get what is explicitly allowed
âœ” Central team controls defaults

7ï¸âƒ£ Helm Release Flow
helm install tenant-a ./tenant-chart -f values-tenant-a.yaml
helm install tenant-b ./tenant-chart -f values-tenant-b.yaml


Each release:

Creates namespace

Applies isolation

Cannot affect other tenants

8ï¸âƒ£ HARDENING (Highly Recommended)
ğŸ” Admission Control (OPA/Gatekeeper)

Require every tenant namespace to have:

default-deny

allow-same-tenant

ğŸ” RBAC

Tenants:

No permission to create/edit NetworkPolicy

No permission to label namespaces

ğŸ” Calico Global Policy (Best Safety Net)

Prevents mistakes even if Helm fails.

9ï¸âƒ£ Final Isolation Guarantee
Attack	Blocked
Tenant tries to reach another tenant	âœ…
Tenant removes NetworkPolicy	âŒ (RBAC)
Tenant fakes labels	âŒ
Tenant opens wildcard access	âŒ
Tenant compromises pod	Contained
10ï¸âƒ£ Want This Taken Further?

I can:

Convert this into a reusable tenant Helm chart

Add OPA policies for enforcement

Design per-service zero-trust policies

Show Calico GlobalNetworkPolicy templates

Add EKS node isolation per tenant

Just say the word ğŸš€

English (US)
English (UK)
æ™®é€šè¯ (ä¸­å›½å¤§é™†)
ä¸­æ–‡ (å°ç£)
ç²µèª (é¦™æ¸¯)
Bahasa Indonesia
Deutsch
EspaÃ±ol (ES)
FranÃ§ais
Italiano
Nederlands
Polski
PortuguÃªs (BR)
æ—¥æœ¬èª
í•œêµ­ì–´
PÑƒÑÑĞºĞ¸Ğ¹
à¤¹à¤¿à¤¨à¥à¤¦à¥€
